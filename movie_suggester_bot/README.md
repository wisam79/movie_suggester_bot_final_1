# بوت اقتراح الأفلام عبر Telegram

بوت Telegram بسيط يقوم باقتراح أفلام للمستخدمين بناءً على النوع المفضل لديهم، مع ميزات إضافية مثل البحث، قائمة المفضلة، ولوحة تحكم للمدير.

## الميزات

*   **اقتراح حسب النوع (/genre):** يعرض قائمة بالأنواع المتاحة، وعند اختيار نوع، يقترح فيلمًا منه مع تفاصيله وصورته.
*   **اقتراح يومي (/daily):** يقترح فيلمًا شائعًا بشكل عشوائي.
*   **قائمة المفضلة (/favorites):** يمكن للمستخدمين إضافة الأفلام المقترحة إلى قائمة المفضلة الخاصة بهم، وعرض القائمة، وإزالة الأفلام منها.
*   **بحث:** يمكن للمستخدمين كتابة اسم فيلم أو كلمة مفتاحية للبحث عنه مباشرة.
*   **أزرار تحكم:** لوحة مفاتيح دائمة (Reply Keyboard) للوصول السريع للأوامر الرئيسية.
*   **لوحة تحكم للمدير:** أوامر خاصة بالمدير (المعرف المحدد في الإعدادات) لعرض الإحصائيات (/stats) وإرسال رسائل جماعية (/broadcast).

## التقنيات المستخدمة

*   Python 3.11+
*   aiogram 3.x
*   aiohttp
*   python-dotenv
*   aiosqlite
*   TMDb API

## الإعداد والتشغيل المحلي

1.  **استنساخ المستودع:**
    ```bash
    git clone <your-repo-url>
    cd movie-suggester-bot
    ```
2.  **إنشاء بيئة افتراضية (اختياري ولكن موصى به):**
    ```bash
    python3 -m venv venv
    source venv/bin/activate  # On Windows use `venv\Scripts\activate`
    ```
3.  **تثبيت المتطلبات:**
    ```bash
    pip install -r requirements.txt
    ```
4.  **إعداد متغيرات البيئة:**
    *   قم بإنشاء ملف باسم `.env` في المجلد الرئيسي للمشروع.
    *   أضف المتغيرات التالية إلى الملف مع استبدال القيم بالقيم الخاصة بك:
        ```dotenv
        TELEGRAM_BOT_TOKEN=7811678852:AAFqDxJp4aS5zli6uyIMTDDeKkQW4Oe5fBU
        TMDB_API_KEY=212b6a3a836ea1acd2281572b2e2d4ea
        ADMIN_ID=7813451177
        # DATABASE_PATH=/path/to/your/data/bot_data.db # Optional: Defaults to data/bot_data.db inside project
        ```
    *   **ملاحظة:** استخدم توكن البوت ومفتاح TMDb الخاصين بك. `ADMIN_ID` هو معرف Telegram الخاص بك لتتمكن من استخدام أوامر المدير.

5.  **تشغيل البوت:**
    ```bash
    python3 -m src.main
    ```

## النشر على Railway

يمكنك نشر هذا البوت بسهولة على منصة Railway ليعمل بشكل مستمر.

1.  **المتطلبات:**
    *   حساب GitHub.
    *   حساب Railway (يمكنك التسجيل مجانًا).
2.  **رفع المشروع إلى GitHub:**
    *   إذا لم يكن المشروع في مستودع GitHub بالفعل، قم بإنشاء مستودع جديد على GitHub.
    *   قم برفع ملفات المشروع (بما في ذلك `Procfile` و `requirements.txt` ولكن **باستثناء** مجلد `venv` وملف `.env` وملف قاعدة البيانات `data/bot_data.db` إذا كان موجودًا) إلى مستودع GitHub الخاص بك.
3.  **إنشاء مشروع جديد على Railway:**
    *   سجل الدخول إلى لوحة تحكم Railway.
    *   انقر على "New Project".
    *   اختر "Deploy from GitHub repo".
    *   قم بربط حساب GitHub الخاص بك إذا لم تكن قد فعلت ذلك من قبل.
    *   اختر مستودع GitHub الذي يحتوي على كود البوت.
    *   سيقوم Railway تلقائيًا باكتشاف `Procfile` و `requirements.txt`.
4.  **إعداد متغيرات البيئة على Railway:**
    *   بعد إنشاء المشروع، انتقل إلى تبويب "Variables" في لوحة تحكم مشروع Railway.
    *   أضف متغيرات البيئة التالية بنفس الطريقة التي أضفتها في ملف `.env` المحلي:
        *   `TELEGRAM_BOT_TOKEN`: توكن بوت Telegram الخاص بك.
        *   `TMDB_API_KEY`: مفتاح TMDb API الخاص بك.
        *   `ADMIN_ID`: معرف Telegram الخاص بك.
        *   `DATABASE_PATH`: **هام:** بشكل افتراضي، نظام الملفات في Railway مؤقت. إذا أردت الاحتفاظ بقاعدة بيانات المفضلة والمستخدمين بين عمليات إعادة التشغيل والنشر، ستحتاج إلى إرفاق وحدة تخزين دائمة (Volume) بخدمتك في Railway وتحديث هذا المسار ليشير إلى نقطة تحميل وحدة التخزين (مثل `/data/bot_data.db`). إذا لم تقم بإرفاق وحدة تخزين، سيتم إنشاء قاعدة البيانات في `/home/ubuntu/movie_suggester_bot/data/bot_data.db` داخل الحاوية المؤقتة وستفقد البيانات عند إعادة التشغيل. للاستخدام البسيط، يمكنك ترك المسار الافتراضي أو عدم تعيين المتغير `DATABASE_PATH`.
5.  **بدء النشر:**
    *   سيقوم Railway تلقائيًا ببدء عملية النشر بمجرد إضافة متغيرات البيئة. يمكنك مراقبة سجلات النشر والتشغيل من تبويب "Deployments".
    *   بمجرد اكتمال النشر بنجاح، سيبدأ البوت بالعمل بشكل مستمر على Railway.

## هيكل المشروع

```
/movie_suggester_bot
|-- /src
|   |-- /handlers         # وحدات معالجة الأوامر والرسائل
|   |   |-- __init__.py
|   |   |-- admin.py
|   |   |-- common.py       # معالجات عامة (start, help, reply keyboard)
|   |   |-- daily.py
|   |   |-- favorites.py
|   |   |-- genre.py
|   |   |-- search.py
|   |-- /services         # وحدات للتفاعل مع الخدمات الخارجية (DB, API)
|   |   |-- __init__.py
|   |   |-- database.py     # عمليات قاعدة البيانات (SQLite)
|   |   |-- tmdb.py         # عمليات TMDb API
|   |-- __init__.py
|   |-- config.py         # تحميل الإعدادات ومتغيرات البيئة
|   |-- main.py           # نقطة الدخول الرئيسية للبوت
|-- /data                 # (يتم إنشاؤه تلقائيًا) لتخزين قاعدة البيانات
|   |-- bot_data.db
|-- .env                  # (محلي فقط) لتخزين متغيرات البيئة
|-- Procfile              # تعريف عملية التشغيل لـ Railway
|-- README.md             # هذا الملف
|-- requirements.txt      # قائمة المكتبات المطلوبة
|-- todo.md               # قائمة المهام (للتطوير)
```

